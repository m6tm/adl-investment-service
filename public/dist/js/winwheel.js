const u=window.io();let I=!1;const b=document.getElementById("winwheelCanvas"),e=b.getContext("2d"),g=200,P=80,f=50,l=b.width/2,s=b.height/2;let a=0;const M=.2,S=.99,y=1e-4,D=6e4,x=[{id:"p1",label:"Prix 1",color:"gold"},{id:"p2",label:"Prix 2",color:"orange"},{id:"p3",label:"Prix 3",color:"darkgoldenrod"},{id:"p4",label:"Prix 4",color:"purple"},{id:"p5",label:"Prix 5",color:"gold"}],h=[{id:"j1",label:"$100.000",bgPriceColor:"#e344d1",borderColor:"#fff",textColor:"#e344d1",bgTextColor:"#fff",borderSize:2},{id:"j2",label:"$250.000",bgPriceColor:"#5588c5",borderColor:"#fff",textColor:"#5588c5",bgTextColor:"#fff",borderSize:2},{id:"j3",label:"$500.000",bgPriceColor:"#7340c9",borderColor:"#fff",textColor:"#7340c9",bgTextColor:"#fff",borderSize:2},{id:"j4",label:"$1.000.000",bgPriceColor:"#e75d6b",borderColor:"#fff",textColor:"#e75d6b",bgTextColor:"#fff",borderSize:2}],E="#dddddd",w=new Image;w.src="https://place-hold.it/64";function C(){if(!e)return;e.clearRect(0,0,b.width,b.height);const t=2*Math.PI/h.length;h.forEach((o,i)=>{const n=t/x.length;x.forEach((d,r)=>{const c=a+t*i+n*r,A=c+n;e.beginPath(),e.moveTo(l,s),e.arc(l,s,g,c,A),e.lineTo(l,s),e.fillStyle=o.bgPriceColor,e.fill(),e.strokeStyle=o.borderColor,e.lineWidth=o.borderSize,e.stroke(),e.closePath();const m=c+n/2;e.save(),e.translate(l+Math.cos(m)*(g*.5),s+Math.sin(m)*(g*.5)),e.rotate(m),e.fillStyle=o.bgTextColor,e.fillText(d.label,0,0),e.restore()})}),h.forEach((o,i)=>{e.beginPath(),e.moveTo(l,s),e.arc(l,s,P,t*i+a,t*(i+1)+a),e.fillStyle=E,e.fill(),e.strokeStyle=o.borderColor,e.lineWidth=o.borderSize,e.stroke(),e.closePath();const n=t*i+a+t/2;e.save(),e.translate(l+Math.cos(n)*(P*.7),s+Math.sin(n)*(P*.7)),e.rotate(n+Math.PI/2),e.fillStyle=o.textColor,e.font="bold 12px "+e.font.split(" ").slice(-1)[0],e.fillText(o.label,-e.measureText(o.label).width/2,0),e.restore()}),e.save(),e.beginPath(),e.arc(l,s,f,0,2*Math.PI),e.clip(),e.drawImage(w,l-f,s-f,f*2,f*2),e.restore(),e.beginPath(),e.arc(l,s,f,0,2*Math.PI),e.strokeStyle="black",e.lineWidth=2,e.stroke(),e.save(),e.translate(l,s-g-20),e.beginPath(),e.moveTo(0,0),e.lineTo(-10,-20),e.lineTo(10,-20),e.closePath(),e.fillStyle="#e75d6b",e.fill(),e.strokeStyle="white",e.lineWidth=2,e.stroke(),e.restore()}function T(t,o){if(Date.now()-t<D&&o>y){a=(a+o)%(2*Math.PI);const n=o*S;C(),requestAnimationFrame(()=>T(t,n))}else{a=a%(2*Math.PI),C();const n=$();I&&u.emit("get draw result",{winner:n.jackpot.label,prize:n.prize.label})}}function $(){const t=Math.PI*1.5,o=2*Math.PI/h.length,i=o/x.length;let n=(t-a)%(2*Math.PI);n<0&&(n+=2*Math.PI);const d=Math.floor(n/o),r=Math.floor(n%o/i);return{jackpot:h[d],prize:x[r]}}function p(){const t=Date.now();T(t,M)}w.onload=C;const v=document.getElementById("countdown-number");function k(t){let o=setInterval(()=>{const i=moment(),d=moment(t).diff(i),r=moment.duration(d),c={days:r.days()>9?r.days():`0${r.days()}`,hours:r.hours()>9?r.hours():`0${r.hours()}`,minutes:r.minutes()>9?r.minutes():`0${r.minutes()}`,seconds:r.seconds()>9?r.seconds():`0${r.seconds()}`};v.textContent=`${c.days} jours ${c.hours} heures ${c.minutes} minutes ${c.seconds} secondes`,d<=0&&(clearInterval(o),p())},1e3)}u.on("connect",()=>{I=!0,p(),u.emit("get next draw date"),u.on("send next draw date",t=>{t=JSON.parse(t),"nextDrawinDate"in t&&k(t.nextDrawinDate)})});
