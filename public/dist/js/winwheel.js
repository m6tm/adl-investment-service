const C=window.moment,g=window.io();let $=!1,A=[];function P(t,o){return Math.floor(Math.random()*(o-t+1))+t}function T(){let t=P(0,360);for(;t%10==0||A.includes(t);)t=P(0,360);return t+20}const h=document.getElementById("winwheelCanvas"),e=h.getContext("2d"),I=80,f=50,a=h.width/2,c=h.height/2;let s=T(),M=s;const E=.2,_=.99,v=1e-4,z=6e4,u=[{id:"p1",label:"$100"},{id:"p2",label:"$250"},{id:"p3",label:"$500"},{id:"p4",label:"$1.000"},{id:"p5",label:"$2.000"},{id:"p6",label:"$5.000"},{id:"p7",label:"$10.000"},{id:"p8",label:"$25.000"},{id:"p9",label:"$50.000"},{id:"p10",label:"$100.000"},{id:"p11",label:"$250.000"},{id:"p12",label:"$500.000"},{id:"p13",label:"$1.000.000"}];let b=[{id:"j1",label:"$100.000",bgPriceColor:"#e344d1",borderColor:"#fff",textColor:"#e344d1",bgTextColor:"#fff",borderSize:2},{id:"j2",label:"$250.000",bgPriceColor:"#5588c5",borderColor:"#fff",textColor:"#5588c5",bgTextColor:"#fff",borderSize:2},{id:"j3",label:"$500.000",bgPriceColor:"#7340c9",borderColor:"#fff",textColor:"#7340c9",bgTextColor:"#fff",borderSize:2},{id:"j4",label:"$1.000.000",bgPriceColor:"#e75d6b",borderColor:"#fff",textColor:"#e75d6b",bgTextColor:"#fff",borderSize:2}];const k="#dddddd",p=new Image;p.src="/images/Roue_ADL.png";function m(){if(!e)return;e.clearRect(0,0,h.width,h.height);const t=2*Math.PI/b.length,o=250;b.forEach((r,n)=>{const i=t/u.length;u.forEach((l,d)=>{const w=s+t*n+i*d,D=w+i;e.beginPath(),e.moveTo(a,c),e.arc(a,c,o,w,D),e.lineTo(a,c),e.fillStyle=r.bgPriceColor,e.fill(),e.strokeStyle=r.borderColor,e.lineWidth=r.borderSize,e.stroke(),e.closePath();const x=w+i/1.3;e.save(),e.translate(a+Math.cos(x)*(o*.6),c+Math.sin(x)*(o*.6)),e.rotate(x),e.fillStyle=r.bgTextColor,e.font="bold 15px Arial",e.fillText(l.label,0,0),e.restore()})}),b.forEach((r,n)=>{e.beginPath(),e.moveTo(a,c),e.arc(a,c,I,t*n+s,t*(n+1)+s),e.fillStyle=k,e.fill(),e.strokeStyle=r.borderColor,e.lineWidth=r.borderSize,e.stroke(),e.closePath();const i=t*n+s+t/2;e.save(),e.translate(a+Math.cos(i)*(I*.7),c+Math.sin(i)*(I*.7)),e.rotate(i+Math.PI/2),e.fillStyle=r.textColor,e.font="bold 12px "+e.font.split(" ").slice(-1)[0],e.fillText(r.label,-e.measureText(r.label).width/2,0),e.restore()}),e.save(),e.beginPath(),e.arc(a,c,f,0,2*Math.PI),e.clip(),e.drawImage(p,a-f,c-f,f*2,f*2),e.restore(),e.beginPath(),e.arc(a,c,f,0,2*Math.PI),e.strokeStyle="black",e.lineWidth=2,e.stroke(),e.save(),e.translate(a,c-o-20),e.beginPath(),e.moveTo(0,0),e.lineTo(-10,-20),e.lineTo(10,-20),e.closePath(),e.fillStyle="#e75d6b",e.fill(),e.strokeStyle="white",e.lineWidth=2,e.stroke(),e.restore()}function y(t,o){if(Date.now()-t<z&&o>v){s=(s+o)%(2*Math.PI);const n=o*_;m(),requestAnimationFrame(()=>y(t,n))}else{s=s%(2*Math.PI),m();const n=N();$&&g.emit("get draw result",JSON.stringify({winner:n.jackpot.label,prize:n.prize.label,angle:M}))}}function N(){const t=Math.PI*1.5,o=2*Math.PI/b.length,r=o/u.length;let n=(t-s)%(2*Math.PI);n<0&&(n+=2*Math.PI);const i=Math.floor(n/o),l=Math.floor(n%o/r);return{jackpot:b[i],prize:u[l]}}function S(){const t=Date.now();y(t,E)}p.onload=m;const O=document.getElementById("countdown-number");function R(t){let o=setInterval(()=>{const r=C(),i=C(t).diff(r),l=C.duration(i),d={days:l.days()>9?l.days():`0${l.days()}`,hours:l.hours()>9?l.hours():`0${l.hours()}`,minutes:l.minutes()>9?l.minutes():`0${l.minutes()}`,seconds:l.seconds()>9?l.seconds():`0${l.seconds()}`};O.textContent=`${d.days} jours ${d.hours} heures ${d.minutes} minutes ${d.seconds} secondes`,i<=0&&(clearInterval(o),S())},1e3)}g.on("connect",()=>{$=!0,console.log("Connected to server"),g.emit("get next draw date"),g.on("send next draw date",t=>{t=JSON.parse(t),"angles"in t&&(A=t.angles,s=T(),M=s,m()),S(),"nextDrawinDate"in t&&R(t.nextDrawinDate)})});
