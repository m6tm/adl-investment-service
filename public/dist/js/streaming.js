const d=document.getElementById("video"),u=`ws://${location.hostname}${location.port===""?"":`:${location.port}`}/streaming`,f=new WebSocket(u),c=new MediaSource;d.src=URL.createObjectURL(c);c.addEventListener("sourceopen",()=>{const o=c.addSourceBuffer('video/webm; codecs="vp8"');let t=[],n=!1;async function a(){if(t.length>0&&!n){n=!0;const r=t.shift();try{await new Promise((e,s)=>{o.appendBuffer(r),o.addEventListener("updateend",e,{once:!0}),o.addEventListener("error",s,{once:!0})})}catch(e){console.error("Error appending buffer:",e)}n=!1,a()}}f.onmessage=async r=>{const e=await r.data.arrayBuffer();console.log("ok",e),t.push(e),a()}});
